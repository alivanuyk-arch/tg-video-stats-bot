# Telegram Bot for Video Analytics

Telegram –±–æ—Ç –¥–ª—è –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –≤–∏–¥–µ–æ-–∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ —è–∑—ã–∫–∞. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Ç–µ–∫—Å—Ç–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º –≤ SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–ó–∞–ø—Ä–æ—Å—ã –Ω–∞ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ–º —è–∑—ã–∫–µ** - –∑–∞–¥–∞–≤–∞–π—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ —Ä—É—Å—Å–∫–æ–º
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è SQL** - –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ì–∏–±—Ä–∏–¥–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - –ø—Ä–∞–≤–∏–ª–∞ + LLM –¥–ª—è –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ç–æ—á–Ω–æ—Å—Ç–∏
- **–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PostgreSQL** - —Ä–∞–±–æ—Ç–∞ —Å —Ä–µ–∞–ª—å–Ω–æ–π –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - –±—ã—Å—Ç—Ä—ã–µ –æ—Ç–≤–µ—Ç—ã –¥–∞–∂–µ –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

## üìä –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤
–°–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ –≤ —Å–∏—Å—Ç–µ–º–µ?
–ü—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ 28 –Ω–æ—è–±—Ä—è 2025
–°–∫–æ–ª—å–∫–æ –≤–∏–¥–µ–æ —É –∫—Ä–µ–∞—Ç–æ—Ä–∞ —Å id abc123?
–í–∏–¥–µ–æ —Å –ø—Ä–æ—Å–º–æ—Ç—Ä–∞–º–∏ > 100000
–°—É–º–º–∞ –ª–∞–π–∫–æ–≤ –≤—Å–µ—Ö –≤–∏–¥–µ–æ

text

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí Telegram Bot ‚Üí LLM (Mistral 7B) ‚Üí SQL ‚Üí PostgreSQL ‚Üí –û—Ç–≤–µ—Ç

text

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
- **`src/bot.py`** - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ Telegram –±–æ—Ç–∞ (aiogram 3.x)
- **`src/llm_fallback.py`** - –≥–∏–±—Ä–∏–¥–Ω—ã–π Text-to-SQL –¥–≤–∏–∂–æ–∫
- **`src/database.py`** - –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä PostgreSQL
- **`src/config.py`** - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- **`run.py`** - —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

### LLM –ú–æ–¥—É–ª—å:
- **–ü—Ä–∞–≤–∏–ª–∞** (5 —Ç–æ—á–Ω—ã—Ö –º–∞—Ç—á–µ–π –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤)
- **–ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥** (–∞–Ω–≥–ª–∏–π—Å–∫–∏–π –ø—Ä–æ–º–ø—Ç —Å —Ä—É—Å—Å–∫–∏–º–∏ –ø—Ä–∏–º–µ—Ä–∞–º–∏)
- **–ê–≤—Ç–æ–∫–æ—Ä—Ä–µ–∫—Ü–∏—è** SQL (–∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ JOIN, –¥–∞—Ç, —É—Å–ª–æ–≤–∏–π)

## üõ†Ô∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫

### 1. –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# Python 3.11+
python --version

# PostgreSQL 14+
psql --version

# Ollama (–¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π LLM)
ollama --version
2. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
bash
pip install -r requirements.txt
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env –Ω–∞ –æ—Å–Ω–æ–≤–µ .env.example:

env
# PostgreSQL
DB_HOST=localhost
DB_PORT=5432
DB_NAME=video_analytics
DB_USER=postgres
DB_PASSWORD=your_password

# Telegram
TELEGRAM_TOKEN=your_bot_token

# LLM (Ollama)
OLLAMA_MODEL=mistral:7b-instruct
OLLAMA_BASE_URL=http://localhost:11434
4. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ JSON
python init_db.py
5. –ó–∞–ø—É—Å–∫ LLM —Å–µ—Ä–≤–µ—Ä–∞
bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –º–æ–¥–µ–ª–∏ (–µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç)
ollama pull mistral:7b-instruct

# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ Ollama
ollama serve
6. –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
bash
python run.py
üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
–¢–∞–±–ª–∏—Ü–∞ videos
sql
id (UUID)                 -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –≤–∏–¥–µ–æ
creator_id (TEXT)         -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫—Ä–µ–∞—Ç–æ—Ä–∞
video_created_at (TIMESTAMP) -- –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏
views_count (INTEGER)     -- –∏—Ç–æ–≥–æ–≤—ã–µ –ø—Ä–æ—Å–º–æ—Ç—Ä—ã
likes_count (INTEGER)     -- –∏—Ç–æ–≥–æ–≤—ã–µ –ª–∞–π–∫–∏
comments_count (INTEGER)  -- –∏—Ç–æ–≥–æ–≤—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
–¢–∞–±–ª–∏—Ü–∞ video_snapshots
sql
id (INTEGER)              -- –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∑–∞–º–µ—Ä–∞
video_id (UUID)           -- —Å—Å—ã–ª–∫–∞ –Ω–∞ –≤–∏–¥–µ–æ
created_at (TIMESTAMP)    -- –≤—Ä–µ–º—è –∑–∞–º–µ—Ä–∞ (–∫–∞–∂–¥—ã–π —á–∞—Å)
views_count (INTEGER)     -- –ø—Ä–æ—Å–º–æ—Ç—Ä—ã –Ω–∞ –º–æ–º–µ–Ω—Ç –∑–∞–º–µ—Ä–∞
delta_views_count (INTEGER) -- –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –∑–∞ —á–∞—Å
delta_likes_count (INTEGER) -- –ø—Ä–∏—Ä–æ—Å—Ç –ª–∞–π–∫–æ–≤ –∑–∞ —á–∞—Å
delta_comments_count (INTEGER) -- –ø—Ä–∏—Ä–æ—Å—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∑–∞ —á–∞—Å
üîß LLM –ü—Ä–æ–º–ø—Ç-–∏–Ω–∂–∏–Ω–∏—Ä–∏–Ω–≥
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≥–∏–±—Ä–∏–¥–Ω—ã–π –ø–æ–¥—Ö–æ–¥:

–ü—Ä–∞–≤–∏–ª–∞ (Rule-based)
python
# –ë—ã—Å—Ç—Ä–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
"—Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –≤–∏–¥–µ–æ" ‚Üí SELECT COUNT(*) FROM videos;
"—Å—É–º–º–∞ –ª–∞–π–∫–æ–≤" ‚Üí SELECT SUM(likes_count) FROM videos;
"—Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ –∑–∞–º–µ—Ä–æ–≤" ‚Üí SELECT COUNT(*) FROM video_snapshots;
LLM –ü—Ä–æ–º–ø—Ç (Prompt-based)
–î–ª—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–º–ø—Ç –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ —Å:

–°—Ö–µ–º–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–†—É—Å—Å–∫–æ-–∞–Ω–≥–ª–∏–π—Å–∫–∏–º —Å–ª–æ–≤–∞—Ä—ë–º —Ç–µ—Ä–º–∏–Ω–æ–≤

–ü—Ä–∏–º–µ—Ä–∞–º–∏ SQL-–∑–∞–ø—Ä–æ—Å–æ–≤

–ü—Ä–∞–≤–∏–ª–∞–º–∏ —Ç—Ä–∞–Ω—Å–ª—è—Ü–∏–∏ –¥–∞—Ç –∏ –≤—Ä–µ–º–µ–Ω–∏

üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
–ó–∞–ø—Ä–æ—Å	–í—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞	–ú–µ—Ç–æ–¥
–ü—Ä–æ—Å—Ç—ã–µ (–ø—Ä–∞–≤–∏–ª–∞)	< 1 —Å–µ–∫	Rule-based
–°—Ä–µ–¥–Ω–µ–π —Å–ª–æ–∂–Ω–æ—Å—Ç–∏	2-5 —Å–µ–∫	LLM + –ø—Ä–æ–º–ø—Ç
–°–ª–æ–∂–Ω—ã–µ —Å JOIN	3-7 —Å–µ–∫	LLM —Å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–µ–π
üêõ –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
bash
# –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–æ–≤
LOG_LEVEL=DEBUG  # DEBUG, INFO, WARNING, ERROR

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
tail -f bot.log
ü§ù –í–∫–ª–∞–¥ –≤ –ø—Ä–æ–µ–∫—Ç
–§–æ—Ä–∫–Ω–∏—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π

–°–æ–∑–¥–∞–π—Ç–µ –≤–µ—Ç–∫—É –¥–ª—è –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

–í–Ω–µ—Å–∏—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

–î–æ–±–∞–≤—å—Ç–µ —Ç–µ—Å—Ç—ã

–°–æ–∑–¥–∞–π—Ç–µ Pull Request

üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è
MIT License - —Å–º–æ—Ç—Ä–∏—Ç–µ —Ñ–∞–π–ª LICENSE

üë®‚Äçüíª –ê–≤—Ç–æ—Ä
Aleksandr Ivanyuk

GitHub: @alivanuyk-arch

Telegram: @alivanuyk

üôè –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏
Ollama –∑–∞ –ª–æ–∫–∞–ª—å–Ω—ã–µ LLM

aiogram –∑–∞ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Telegram –±–æ—Ç–æ–≤

PostgreSQL –∑–∞ –Ω–∞–¥—ë–∂–Ω—É—é –ë–î